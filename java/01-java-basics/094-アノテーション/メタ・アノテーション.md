# メタ・アノテーション

# Q,

メタアノテーションの一覧を整理してください。

承知しました。

Javaでアノテーションを定義する際に使用できる **メタアノテーション（meta-annotation）** について、以下にまとめます。

---

## ✅ メタアノテーション一覧表

| メタアノテーション | パッケージ | 目的・効果 | 適用対象 |
| --- | --- | --- | --- |
| `@Target` | `java.lang.annotation` | アノテーションを付けられる場所を制限（例：クラス、メソッド、フィールドなど） | アノテーション定義 |
| `@Retention` | `java.lang.annotation` | アノテーションの**保持期間**を指定（コンパイル時のみ or 実行時まで） | アノテーション定義 |
| `@Documented` | `java.lang.annotation` | `javadoc`にこのアノテーションの使用を表示する | アノテーション定義 |
| `@Inherited` | `java.lang.annotation` | アノテーションを**サブクラスに自動継承**させる | クラスに付けたアノテーションのみ |
| `@Repeatable` | `java.lang.annotation`（Java 8+） | 同じアノテーションを**複数回**同じ要素に付けられるようにする | アノテーション定義 |
| `@Native` | `java.lang.annotation` | `final static`フィールドに付けると、ネイティブコード（Cなど）にも定数として展開される | フィールド |

---

## 📝 各メタアノテーションの詳細と例

---

### 1. `@Target`

- **何にアノテーションを付けられるか**を制限

```java
@Target(ElementType.METHOD)
public @interface MyMethodOnly {}
```

| `ElementType`の例 | 対象 |
| --- | --- |
| `TYPE` | クラス・インタフェース・enum |
| `METHOD` | メソッド |
| `FIELD` | フィールド |
| `PARAMETER` | 引数 |
| `CONSTRUCTOR` | コンストラクタ |
| `ANNOTATION_TYPE` | アノテーション定義自身 |
| `PACKAGE` | パッケージ定義 |

---

### 2. `@Retention`

- **いつまでアノテーションを保持するか**

```java
@Retention(RetentionPolicy.RUNTIME)
```

| 値 | 説明 | 用途例 |
| --- | --- | --- |
| `SOURCE` | コンパイル時に破棄 | APT, Lintなど |
| `CLASS` | クラスファイルに残るがJVMでは使えない（デフォルト） | 内部処理 |
| `RUNTIME` | JVM実行時にも参照可能 | リフレクション、フレームワーク |

---

### 3. `@Documented`

- **javadocに表示させるかどうか**

```java
@Documented
```

- 省略すると `@MyAnnotation` を使っても javadoc には出ない。

---

### 4. `@Inherited`

- **クラスに付けたアノテーションをサブクラスに自動継承**

```java
@Inherited
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface MyTag {}
```

📌 **注意点**

- クラスに対してのみ機能
- メソッドやフィールドには継承されない

---

### 5. `@Repeatable`（Java 8以降）

- 同じアノテーションを **複数回使えるようにする**

### 定義例：

```java
@Repeatable(Hints.class)
public @interface Hint {
    String value();
}

public @interface Hints {
    Hint[] value();
}
```

### 使用例：

```java
@Hint("A")
@Hint("B")
public class MyClass {}
```

---

### 6. `@Native`

- ネイティブコード（JNIなど）で定数を使えるようにする

```java
@Native
public static final int ERROR_CODE = 42;
```

---

## ✅ まとめ：メタアノテーション活用の指針

| よく使う | 理由 |
| --- | --- |
| `@Target` | 使用箇所の制限は必須レベル |
| `@Retention` | `SOURCE` か `RUNTIME` を必ず明示するべき |
| `@Documented` | ライブラリ開発などで利用推奨 |
| `@Inherited` | 設計上、クラス単位の意味付けを継承させたいとき |
| `@Repeatable` | 設定や宣言を複数記述したいとき |
| `@Native` | JNIなどC言語連携時に定数を共有する必要があるとき |

---

必要であれば、実務での使い分け方や、これらを組み合わせた「アノテーション設計のベストプラクティス」もご紹介できます！

# Q,

上記メタ・アノテーションのデフォルト値をまとめてください。

承知しました。

以下に、Javaの主要な**メタアノテーション**の**デフォルト値（省略時の動作）**をまとめます。

---

## ✅ メタアノテーションのデフォルト値一覧表

| メタアノテーション | デフォルト値 | 省略時の効果 | 明示推奨か |
| --- | --- | --- | --- |
| `@Retention` | `RetentionPolicy.CLASS` | クラスファイルには記録されるが、**リフレクションでは取得不可** | ✅ **必ず明示が推奨**（`SOURCE` or `RUNTIME`） |
| `@Target` | すべての`ElementType`が対象（制限なし） | **クラス・メソッド・フィールドなど全要素に付けられる** | ✅ 意図的に制限したいなら明示すべき |
| `@Documented` | `false`（javadocに表示されない） | javadocにアノテーションが**表示されない** | ⭕ ライブラリやAPI公開時は明示推奨 |
| `@Inherited` | `false`（継承されない） | 親クラスのアノテーションは**子クラスに引き継がれない** | ⭕ 設計意図があるときに明示 |
| `@Repeatable` | 使用しなければ非リピート（単一適用のみ） | **同じアノテーションは1つしか付けられない** | ✅ 複数適用したいときは必須で明示 |
| `@Native` | 該当なし（対象が`static final`であれば有効） | 通常の `final static` フィールドのみ | ⭕ JNI等を使うときに明示使用 |

---

## 🔍 詳細解説（簡潔）

### ◉ `@Retention`

| 値 | 説明 |
| --- | --- |
| `SOURCE` | コンパイル時に破棄される（APTで使う） |
| `CLASS`（🔸デフォルト） | クラスファイルには記録されるがJVMで読み取れない（リフレクション不可） |
| `RUNTIME` | 実行時も保持され、リフレクションで読み取れる |

→ ✅ **リフレクションで使いたい場合は必ず `RUNTIME` を明示する必要あり**

---

### ◉ `@Target`

省略すると以下の**全ての構造に適用可能**になります：

```java
ElementType.ANNOTATION_TYPE,
ElementType.CONSTRUCTOR,
ElementType.FIELD,
ElementType.LOCAL_VARIABLE,
ElementType.METHOD,
ElementType.PACKAGE,
ElementType.PARAMETER,
ElementType.TYPE,
ElementType.TYPE_PARAMETER,
ElementType.TYPE_USE

```

→ ✅ **意図しない場所への適用を避けたい場合は `@Target` を明示**

---

## ✅ 実務的なベストプラクティスまとめ

| ケース | 推奨設定 |
| --- | --- |
| APTで使うアノテーション | `@Retention(SOURCE)` + `@Target(...)` |
| リフレクションで使う | `@Retention(RUNTIME)` + `@Target(...)` |
| ライブラリで外部公開 | `@Documented` 明示 |
| 設計上の意味を子クラスに継承させたい | `@Inherited` 明示 |
| アノテーションを複数回使いたい | `@Repeatable` 明示 + コンテナアノテーション定義 |

---

必要であれば「メタアノテーションの組み合わせパターン」や「設計目的別テンプレート」もまとめられます！