# ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

# Q,

APTã‚„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿéš›ã«å€¤ã‚’èª­ã¿å–ã£ã¦åˆ†å²å‡¦ç†ã™ã‚‹ãƒŸãƒ‹ã‚µãƒ³ãƒ—ãƒ«ã‚’ãŠé¡˜ã„ã—ã¾ã™

äº†è§£ã—ã¾ã—ãŸï¼

ä»¥ä¸‹ã«ã€**APTï¼ˆã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚»ãƒƒã‚µï¼‰ã¨ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**ã®ãã‚Œãã‚Œã§ã€Œã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å€¤ã‚’èª­ã¿å–ã‚Šã€å‡¦ç†ã‚’åˆ†å²ã™ã‚‹ã€ãƒŸãƒ‹ã‚µãƒ³ãƒ—ãƒ«ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

---

## âœ… 1. ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å€¤ã‚’èª­ã¿å–ã‚‹ï¼ˆå®Ÿè¡Œæ™‚ï¼‰

### â—‰ ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©

```java
import java.lang.annotation.*;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Role {
    String value();  // "ADMIN" ãªã©
}
```

---

### â—‰ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã‚¯ãƒ©ã‚¹

```java
public class UserService {

    @Role("ADMIN")
    public void deleteUser() {
        System.out.println("Deleting user...");
    }

    @Role("USER")
    public void viewUser() {
        System.out.println("Viewing user...");
    }
}
```

---

### â—‰ ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§å€¤ã‚’èª­ã¿å–ã‚Šå‡¦ç†åˆ†å²

```java
import java.lang.reflect.Method;

public class AnnotationProcessor {

    public static void main(String[] args) throws Exception {
        UserService service = new UserService();

        for (Method method : UserService.class.getDeclaredMethods()) {
            if (method.isAnnotationPresent(Role.class)) {
                Role role = method.getAnnotation(Role.class);
                String roleValue = role.value();

                if ("ADMIN".equals(roleValue)) {
                    System.out.println("ADMINæ¨©é™ãŒå¿…è¦ãªå‡¦ç†: " + method.getName());
                } else if ("USER".equals(roleValue)) {
                    System.out.println("USERç”¨å‡¦ç†: " + method.getName());
                }
            }
        }
    }
}
```

---

## âœ… 2. APTï¼ˆAnnotation Processing Toolï¼‰ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å€¤ã‚’èª­ã¿å–ã‚‹ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ï¼‰

### â—‰ ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©

```java
import java.lang.annotation.*;

@Retention(RetentionPolicy.SOURCE)
@Target(ElementType.TYPE)
public @interface GenerateClass {
    String className();
}
```

---

### â—‰ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã‚¯ãƒ©ã‚¹

```java
@GenerateClass(className = "HelloGenerated")
public class MyOriginalClass {
}
```

---

### â—‰ APTãƒ—ãƒ­ã‚»ãƒƒã‚µå®Ÿè£…ï¼ˆ`javax.annotation.processing.AbstractProcessor`ï¼‰

```java
import javax.annotation.processing.*;
import javax.lang.model.SourceVersion;
import javax.lang.model.element.*;
import java.io.IOException;
import java.io.Writer;
import java.util.Set;

@SupportedAnnotationTypes("GenerateClass")
@SupportedSourceVersion(SourceVersion.RELEASE_17)
public class GenerateClassProcessor extends AbstractProcessor {

    @Override
    public boolean process(Set<? extends TypeElement> annotations, RoundEnvironment roundEnv) {
        for (Element element : roundEnv.getElementsAnnotatedWith(GenerateClass.class)) {
            GenerateClass annotation = element.getAnnotation(GenerateClass.class);
            String className = annotation.className();

            try (Writer writer = processingEnv.getFiler().createSourceFile(className).openWriter()) {
                writer.write("public class " + className + " {\n");
                writer.write("    public static void sayHello() {\n");
                writer.write("        System.out.println(\"Hello from generated class!\");\n");
                writer.write("    }\n");
                writer.write("}\n");
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
        return true;
    }
}
```

ğŸ“Œ ã“ã®ãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’ `META-INF/services/javax.annotation.processing.Processor` ã«ç™»éŒ²ã™ã‚‹ã“ã¨ã§æœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ”š è£œè¶³ã¨çµè«–

| æŠ€è¡“ | ã‚¿ã‚¤ãƒŸãƒ³ã‚° | å‡¦ç†å¯¾è±¡ | ç”¨é€”ä¾‹ |
| --- | --- | --- | --- |
| ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | å®Ÿè¡Œæ™‚ | ãƒ¡ã‚½ãƒƒãƒ‰/ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰/ã‚¯ãƒ©ã‚¹ | DIã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ­ã‚°å‡¦ç†ãªã© |
| APT | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ | è‡ªå‹•ç”Ÿæˆã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ |

---

ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æ–¹ãŒè©¦ã—ã‚„ã™ã„ã§ã™ãŒã€APTã¯é™çš„è§£æãƒ»ã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆã®åˆ†é‡ã§å¼·åŠ›ã§ã™ã€‚

å¿…è¦ã§ã‚ã‚Œã°ã€ŒLomboké¢¨ã®è‡ªå‹•ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ã‚„ã€Œç‹¬è‡ªDIã®æ³¨å…¥å‡¦ç†ã€ãªã©ã®é«˜åº¦ãªä¾‹ã‚‚ã”ç”¨æ„ã§ãã¾ã™ã€‚

# Q,

ä¸Šè¨˜è§£èª¬ä¸­ã€1. ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å€¤ã‚’èª­ã¿å–ã‚‹ï¼ˆå®Ÿè¡Œæ™‚ï¼‰ã¯ã€äº‹å‰ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨æ³¨é‡ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã®æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰è¨­å®šâ†’ãã‚Œãã‚Œã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚¿ã‚°ä»˜ã‘â†’ãã®ã‚¿ã‚°ã”ã¨ã«å‡¦ç†ã‚’åˆ†å²ã‚’ã—ã¦ã„ã‚‹èªè­˜ã§ã™ã€‚
ã“ã®ã‚¿ã‚°ä»˜ã‘ã¯ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ç„¡ãã¦ã‚‚å¯èƒ½ã ãŒã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Œã°ãã®ã‚¿ã‚°ã‚’ä½¿ã„å›ã›ã‚‹ã¨ã„ã£ãŸèªè­˜ã¯ã‚ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ

ã¯ã„ã€éå¸¸ã«æœ¬è³ªã‚’çªã„ãŸæ‰ãˆæ–¹ã§ã™ã€‚

ã‚ãªãŸã®èªè­˜ã¯**æ¦‚ã­æ­£ç¢ºã§ã€ã‚ã¨å°‘ã—è£œè¶³ã™ã‚‹ã¨ã‚ˆã‚Šæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚**

---

## âœ… ã‚ãªãŸã®ç†è§£ã®è¦ç‚¹ã¨è£œè¶³

### ğŸ¯ ã”èªè­˜ï¼š

> ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¿ã‚°ä»˜ã‘ã®1ã¤ã®æ–¹æ³•ã§ã‚ã‚Šã€äº‹å‰ã«å®šç¾©ã—ãŸã‚¿ã‚°ï¼ˆå±æ€§ä»˜ãï¼‰ã‚’å„ãƒ¡ã‚½ãƒƒãƒ‰ã«ä»˜ã‘ã¦ã€å¾Œã§ãã‚Œã«åŸºã¥ã„ã¦å‡¦ç†ã‚’åˆ†å²ã™ã‚‹ä»•çµ„ã¿ã€‚
> 
> 
> â†’ ã“ã®ã‚¿ã‚°ä»˜ã‘ã¯ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ãªãã¦ã‚‚ã€Œã§ããªãã¯ãªã„ã€ã€‚
> 

ã“ã®èªè­˜ã¯**ãã®é€šã‚Šã§ã™**ã€‚

ã—ã‹ã—ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã“ã¨ã«ã¯**ä»¥ä¸‹ã®ã‚ˆã†ãªå¤§ããªåˆ©ç‚¹**ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ” ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Œã‚¿ã‚°ä»˜ã‘ã€ã™ã‚‹ã“ã¨ã®ãƒ¡ãƒªãƒƒãƒˆ

| è¦³ç‚¹ | é€šå¸¸ã®ã‚¿ã‚°ä»˜ã‘ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆ/å‘½åãªã©ï¼‰ | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ©ç”¨ |
| --- | --- | --- |
| ğŸ”¹ **æ§‹æ–‡çš„ä¿è¨¼** | ãªã—ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰ | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§ãƒã‚§ãƒƒã‚¯ã§ãã‚‹ |
| ğŸ”¹ **å†åˆ©ç”¨æ€§** | å‘½åè¦ç´„ã®å¾¹åº•ãŒå¿…è¦ | å®šç¾©1ã¤ã§å…¨ä½“ã«ä½¿ã„å›ã›ã‚‹ |
| ğŸ”¹ **ãƒ„ãƒ¼ãƒ«é€£æº** | IDEã‚„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã¯è§£é‡ˆä¸å¯ | IDEè£œå®Œãƒ»é™çš„è§£æãƒ»å‡¦ç†ç³»ã«å¯¾å¿œ |
| ğŸ”¹ **ãƒ¡ã‚¿æƒ…å ±ã®æ§‹é€ åŒ–** | é›£ã—ã„ï¼ˆæ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ï¼‰ | å±æ€§ä»˜ãã§æ§‹é€ çš„ã«æ¸¡ã›ã‚‹ |
| ğŸ”¹ **ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³/APTã§ã®å‡¦ç†** | ä¸å¯ï¼ˆæ–‡å­—åˆ—å‡¦ç†ãŒå¿…è¦ï¼‰ | `.getAnnotation()` ãªã©ã§ç›´æ¥å–å¾—å¯ |

---

## ğŸ”§ ä»£æ›¿æ‰‹æ®µã¨ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å„ªä½æ€§

### â—‰ ä»£æ›¿æ‰‹æ®µï¼šå‘½åè¦ç´„ã‚„ã‚³ãƒ¡ãƒ³ãƒˆ

```java
// [ADMIN_ONLY]
public void deleteUser() { ... }

if (method.getName().contains("Admin")) {
    // ç®¡ç†è€…å‡¦ç†
}
```

â†’ **ã§ããªãã¯ãªã„ãŒã€å£Šã‚Œã‚„ã™ããƒ»æ›–æ˜§**

---

### â—‰ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ãŸå …ç‰¢ãªæ–¹å¼

```java
@Role("ADMIN")
public void deleteUser() { ... }

if (method.isAnnotationPresent(Role.class)) {
    String value = method.getAnnotation(Role.class).value();
    // åˆ†å²å‡¦ç†
}
```

â†’ **æ˜ç¤ºçš„ãƒ»å†åˆ©ç”¨æ€§é«˜ãƒ»ãƒ„ãƒ¼ãƒ«å¯¾å¿œãƒ»æ§‹æ–‡çš„å®‰å…¨**

---

## âœ… çµè«–ï¼šã‚ãªãŸã®èªè­˜ï¼‹è£œè¶³

> âœ… **ã€Œã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä½¿ã„å›ã—å¯èƒ½ãªæ§‹é€ åŒ–ã‚¿ã‚°ã§ã‚ã‚Šã€å …ç‰¢ãªå†åˆ©ç”¨ãƒ»è‡ªå‹•å‡¦ç†ãŒå¯èƒ½ã«ãªã‚‹ã€**ã¨ã„ã†ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚
> 

ã¤ã¾ã‚Šã“ã†è¨€ãˆã¾ã™ï¼š

> ğŸ”¸ã€Œã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€æ„å‘³ã‚’æŒã¤ã‚¿ã‚°ã‚’ã€å®‰å…¨ã«ãƒ»å†åˆ©ç”¨å¯èƒ½ã«ãƒ»å‡¦ç†å¯èƒ½ãªå½¢ã§ã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã«ä»˜ã‘ã‚‹ãŸã‚ã®ç¬¬ä¸€ç´šã®æ§‹æ–‡çš„æ‰‹æ®µã§ã‚ã‚‹ã€
> 

---

ã•ã‚‰ã«ç™ºå±•çš„ã«ç†è§£ã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã‚‚æ¤œè¨ã§ãã¾ã™ï¼š

- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã« **enumå‹ã‚„ã‚¯ãƒ©ã‚¹å‹ã®å±æ€§**ã‚’æŒãŸã›ã‚‹ï¼ˆæ§‹é€ åŒ–ã•ã‚ŒãŸã‚¿ã‚°ï¼‰
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã« **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ã‚„ **è¤‡æ•°æŒ‡å®šï¼ˆ@Repeatableï¼‰** ã‚’ä½¿ã†å¿œç”¨
- DIã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒ **ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èª­ã¿å–ã£ã¦ã©ã®ã‚ˆã†ã«å‡¦ç†ã—ã¦ã„ã‚‹ã‹** ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã™ã‚‹

å¿…è¦ã«å¿œã˜ã¦æ·±æ˜ã‚Šã‚‚ã§ãã¾ã™ã®ã§ã€ã„ã¤ã§ã‚‚ã©ã†ãã€‚