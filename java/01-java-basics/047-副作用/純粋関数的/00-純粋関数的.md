# 純粋関数的

# Q,

「Javaで純粋関数的に書くテクニック」をお願いします。

Hiroakiさん、お待たせしました！

ここでは、**Javaで「純粋関数的」に書くテクニック**を具体例つきで丁寧に解説します。

---

## ✅ 結論：

Javaでも「副作用を避ける」「関数の入力＝出力に限定する」ことで、**純粋関数的なスタイル**を実現できます。

---

## ✅ 純粋関数とは？

> 「入力だけに依存して出力を返し、副作用がない関数」
> 
> 
> 以下のような特徴を持ちます：
> 

| 項目 | 内容 |
| --- | --- |
| 入力に対して出力が常に同じ | Yes（状態に依存しない） |
| グローバル変数やフィールドに依存しない | Yes |
| 出力・書き込み・通信などの副作用がない | Yes |

---

## ✅ Javaで純粋関数的に書くテクニック一覧

| テクニック | 説明 | 例 |
| --- | --- | --- |
| ① 不変（immutable）な引数を使う | 入力値を変更しない | `List<String>` を `List.copyOf(...)` で複製 |
| ② 副作用を排除する | 出力・ログ・書き込みは関数外へ | `System.out.println()` を別関数に |
| ③ 値を返すようにする | void関数は避け、戻り値で表現 | `transform(x)` の形にする |
| ④ 引数をすべて明示する | グローバル・static・フィールドに依存しない | `compute(a, b)` |
| ⑤ メソッド参照・ラムダ式を活用 | 処理を引数で渡して再利用性を高める | `map(String::length)` |

---

## ✅ 具体例1：名前の正規化

### ❌ 非純粋関数（副作用あり）

```java
String normalizedName;
public void normalizeAndPrint(String name) {
    normalizedName = name.trim().toLowerCase(); // フィールドを更新（副作用）
    System.out.println(normalizedName);         // 出力も副作用
}
```

### ✅ 純粋関数的リファクタリング

```java
public String normalize(String name) {
    return name.trim().toLowerCase(); // 引数にだけ依存・出力なし
}

// 呼び出し側で責任を持って使う
String result = normalize("  Taro  ");
System.out.println(result); // 出力は別責任
```

---

## ✅ 具体例2：リストの変換（map）

```java
public List<String> toUpperCaseList(List<String> input) {
    return input.stream()
                .map(String::toUpperCase)
                .toList(); // Java 16以降
}
```

- 入力だけに依存し、出力だけを返す
- `input` 自体を変更しない（非破壊）
- スレッドセーフ・テストしやすい

---

## ✅ 具体例3：テストがしやすい純粋関数

```java
public int calculateTax(int price, double rate) {
    return (int)(price * rate);
}
```

- **常に同じ結果が返る**
- モック不要でユニットテストが簡単

---

## ✅ 避けたいアンチパターン

| アンチパターン | 解説 |
| --- | --- |
| メソッド内で `System.out.println()` | 出力は副作用になる |
| メソッド内で `List.add()` などで引数を変更 | 不変性を破壊 |
| フィールド・static変数を参照する | 状態依存で予測不能に |

---

## ✅ 純粋関数的に書く利点

| 項目 | メリット |
| --- | --- |
| テスト容易性 | モック・状態管理が不要 |
| 再利用性 | 同じ処理を他の文脈でも使える |
| 並列・非同期処理との相性 | 状態を持たないので安全 |
| 保守性 | 処理の影響範囲が狭くなる |

---

## ✅ まとめ

| 指針 | 実践内容 |
| --- | --- |
| 入力＝出力に限定 | 引数だけを使って戻り値を返す |
| 副作用を関数の外に | 出力・ログ・DBアクセスなどは外へ |
| 不変のデータを使う | 引数は変更せず、結果を新たに返す |
| メソッド参照やラムダ式の活用 | 抽象度を高めて再利用可能に |

---

ご希望があれば、「純粋関数 vs 非純粋関数のテストコード比較」や「DIやファンクショナルインターフェースとの組み合わせ例」もご紹介できます！

[メソッド (副作用メイン)](%E7%B4%94%E7%B2%8B%E9%96%A2%E6%95%B0%E7%9A%84%2021f62cef735080fca0f4dc3edf8b4923/%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%20(%E5%89%AF%E4%BD%9C%E7%94%A8%E3%83%A1%E3%82%A4%E3%83%B3)%2021c62cef735080719e5dc00eed2cd38b.md)