# 共変戻り値 - ジェネリクスの場合

# Q,

public List<Number> test(Set<CharSequence> s) {
return null;
}

上記ののメソッドが親クラスにある、サブクラスにて以下のメソッドがオーバーライドできずコンパイルエラーになるのはなぜですか？

public List<Integer> test(Set<CharSequence> s) {
・・・
}

とても良いご質問です、Hiroakiさん。

Javaの**ジェネリクス（Generics）とオーバーライドのルール**に関する重要なポイントが含まれています。

---

## ✅ 結論：

> public List<Integer> test(Set<CharSequence> s) は、
> 
> 
> `public List<Number> test(Set<CharSequence> s)` の**正しいオーバーライドにはなりません**。
> 
> なぜなら、**戻り値の型が「List<Number>」と「List<Integer>」で異なり、**
> 
> **「共変戻り値の条件」に合っていないから**です。
> 

---

## 🔍 詳しく解説：オーバーライドの成立条件

Javaでメソッドをオーバーライドするには、次の条件が **すべて** 成立していなければいけません：

| 条件 | 説明 |
| --- | --- |
| メソッド名が同じ | ✅ 同じ |
| 引数リストが同じ（完全一致） | ✅ `Set<CharSequence>` → 一致 |
| 戻り値の型が同じか、共変型 | ❌ `List<Number>` ≠ `List<Integer>` → **ジェネリクスでは共変にならない** |
| アクセス修飾子が同じかより広い | ✅ `public` → `public` |
| 例外の制限が親と同じかより狭い | （今回関係なし） |

---

## ❗ 戻り値の「共変（Covariant）型」とは？

共変が許されるのは**非ジェネリック型**に限られます。

✅ OKな例（非ジェネリクス）：

```java
// 親クラス
public Number getValue() { return 1; }

// サブクラス（戻り値がNumberのサブタイプ）
@Override
public Integer getValue() { return 1; }
```

➡ **このように、戻り値の型がサブタイプであればオーバーライドOKです。**

---

## 🚫 ただし Generics（List<Number> vs List<Integer>）は例外！

```java
List<Number> ≠ List<Integer>
```

- Javaのジェネリクスは**不変（invariant）**です。
- `List<Number>` は `List<Integer>` のスーパータイプでは**ありません**。
- **型が違うと判断され、オーバーライドできません。**

---

## ✅ 対処法・回避案

### 方法①：親と同じ戻り値にする

```java
@Override
public List<Number> test(Set<CharSequence> s) {
    // ...
}
```

### 方法②：共通のインターフェース型を戻す（柔軟性あり）

```java
@Override
public List<? extends Number> test(Set<CharSequence> s) {
    // ...
}
```

※ただしこれは「正確なオーバーライド」ではなく、**メソッドシグネチャが変わるためオーバーライドにはなりません**。

---

## ✅ まとめ

| 比較項目 | 親クラス | サブクラス | 結果 |
| --- | --- | --- | --- |
| メソッド名 | `test` | `test` | ✅ 一致 |
| 引数の型 | `Set<CharSequence>` | `Set<CharSequence>` | ✅ 一致 |
| 戻り値の型 | `List<Number>` | `List<Integer>` | ❌ 不一致（ジェネリクスは共変不可） |
| オーバーライド成立？ |  |  | ❌ コンパイルエラーになる |

---

必要であれば：

- Genericsの共変・反変の仕組み（`? extends`, `? super`）の図解
- `List<Number>` と `List<Integer>` の代入関係とコンパイル検証
- メソッドオーバーロードとの違い

なども詳しく解説できます。続けますか？