# 不変オブジェクト参照変更

# Q,

```java
public class Main{
        public static void main(String[] args) {
                String str = "hoge, world";
                hello(str);
                System.out.println(str);
        }
        private static void hello (String msg) {
                str =msg.replaceAll("hoge", "hello");
        }
}
```

上記コードでは、str は "hello, world" の参照になりますか？

いいえ、そのコードのままだと `str` は **"hello, world" にはなりません**。

`str` の中身は **元の `"hoge, world"` のまま**です。

---

## 🔍 詳細な解説

まず、以下の部分を見てみましょう：

```java
String str = "hoge, world";
hello(str);
System.out.println(str); // 出力は？
```

`hello(str)` を呼び出していますが、そのメソッドの中身は次のようになっています：

```java
private static void hello(String msg) {
    str = msg.replaceAll("hoge", "hello");
}
```

このコードは **コンパイルエラーになります**。

なぜなら、`hello()` メソッドの中で `str` という**未定義の変数に代入しようとしている**からです。

---

## ✅ 修正して考える（意図された処理）

おそらく、意図は「`msg` を `replaceAll` して変えたい」だったと思われます。

その場合、こうなるのが正しいはずです：

```java
private static void hello(String msg) {
    msg = msg.replaceAll("hoge", "hello");
}
```

これで **コンパイルは通ります**が、やはり `main()` の `str` には影響がありません。

---

## 🤔 なぜ `str` は変化しないのか？

### 理由：**Javaは「値渡し（pass-by-value）」だから**

- Javaでは**メソッドに渡す引数はすべて値渡し**です。
- `String` は**不変（immutable）**なオブジェクトです。
- `msg.replaceAll(...)` は**新しいStringを生成**しますが、それを `msg` に再代入しても **`str` には影響しません**。

つまり：

```java
String str = "hoge, world";
hello(str);
// helloの中では msg = "hello, world" になっても、str は変わらない
```

---

## ✅ 正しく文字列を置き換えて、`str` を更新するには？

`hello()` の戻り値を受け取る必要があります：

```java
public class Main {
    public static void main(String[] args) {
        String str = "hoge, world";
        str = hello(str);  // ← 戻り値で上書き
        System.out.println(str); // → hello, world
    }

    private static String hello(String msg) {
        return msg.replaceAll("hoge", "hello");
    }
}
```

---

## ✅ 補足：Stringは「参照型」なのに、なぜ変更できないのか？

- `String` は参照型ではありますが、「**不変（immutable）**」です。
- つまり、参照そのものを渡しても、**中身を書き換える手段が提供されていない**のです。
- `StringBuilder` を使えば可変性を持たせられます。

---

## ✔ 最終的な答え

> あなたのコードでは、str は "hello, world" にはなりません。
> 
> 
> さらに、`hello()` メソッド内の `str = ...` は **ローカル変数で定義されていないためコンパイルエラー**になります。
> 
> `msg` に対して `replaceAll` をしても、`main()` の `str` は変化しません。
> 

---

必要であれば、`StringBuilder` を使った可変な処理の書き方も紹介できます！