# ラッパークラスのキャッシュ

はい、`Integer` のラッパークラスキャッシュ（-128〜127の範囲）はよく知られていますが、**実は他のラッパークラスにもキャッシュの仕組みがあります**。

以下に Java における**ラッパークラス（プリミティブ型のオブジェクト版）のキャッシュの仕組みとクラスごとの違い**を詳しく整理して解説します。

---

## ✅ ラッパークラスとは（前提）

| プリミティブ型 | ラッパークラス |
| --- | --- |
| `int` | `Integer` |
| `long` | `Long` |
| `short` | `Short` |
| `byte` | `Byte` |
| `char` | `Character` |
| `boolean` | `Boolean` |
| `float` | `Float` |
| `double` | `Double` |

---

## ✅ ラッパークラスのキャッシュとは？

`valueOf()` メソッドなどでラッパークラスを生成するとき、**頻出する値（主に小さな値）を再利用（キャッシュ）**することで、メモリ使用量を抑え、比較の効率も高めます。

---

## ✅ クラス別のキャッシュ仕様（JDKの標準実装に基づく）

| クラス | キャッシュされる範囲 | 備考 |
| --- | --- | --- |
| **Integer** | **-128 ～ 127** | デフォルト、拡張可能（VM引数で） |
| **Long** | -128 ～ 127 | 固定（変更不可） |
| **Short** | -128 ～ 127 | 固定 |
| **Byte** | -128 ～ 127 | 固定（byteの全範囲） |
| **Character** | 0 ～ 127 | ASCII文字のみ |
| **Boolean** | `true` / `false` のみ | 全てキャッシュされる |
| **Float** | ❌ キャッシュなし | 毎回新規インスタンス |
| **Double** | ❌ キャッシュなし | 同上 |

---

## ✅ Integerのキャッシュ仕様（拡張可能）

```java
Integer a = Integer.valueOf(100);
Integer b = Integer.valueOf(100);
System.out.println(a == b);  // true

Integer x = Integer.valueOf(200);
Integer y = Integer.valueOf(200);
System.out.println(x == y);  // false（範囲外）
```

Java起動時に以下のようにオプション指定すれば、キャッシュ範囲を拡大可能：

```java
-Djava.lang.Integer.IntegerCache.high=1000
```

---

## ✅ キャッシュされる理由：valueOf() の挙動

```java
Integer a = Integer.valueOf(100);
```

- キャッシュ範囲内なら：**既存のインスタンスを再利用**
- 範囲外なら：**新しいオブジェクトが生成される**

`new Integer(100)` のように `new` を使えば **常に新規生成され、キャッシュされない**

---

## ✅ 比較の注意点（== vs equals）

```java
Integer a = Integer.valueOf(100);
Integer b = Integer.valueOf(100);
System.out.println(a == b);        // true（キャッシュされるため）
System.out.println(a.equals(b));   // true

Integer x = Integer.valueOf(200);
Integer y = Integer.valueOf(200);
System.out.println(x == y);        // false（キャッシュ範囲外）
System.out.println(x.equals(y));   // true
```

---

## ✅ キャッシュの有無での使用判断のまとめ

| 型 | キャッシュされるか？ | == 比較の注意点 | 備考 |
| --- | --- | --- | --- |
| Integer | ✅ -128～127（拡張可） | キャッシュ範囲外は false | valueOf()を使うことが推奨 |
| Long | ✅ -128～127 |  |  |
| Short | ✅ -128～127 |  |  |
| Byte | ✅ -128～127（全範囲） |  |  |
| Character | ✅ 0～127（ASCII） |  |  |
| Boolean | ✅ true/false | 常に同じ参照 |  |
| Float | ❌ | == は常に false（別インスタンス） | `equals()`を使うべき |
| Double | ❌ | 同上 |  |

---

## ✅ 実務でのポイント

- **valueOf()を使う癖をつけるとキャッシュが有効になりやすい**
- **== で比較するのは原則プリミティブ型だけ**。ラッパー型では `equals()` を使うのが安全
- `Float` / `Double` は常に新しいオブジェクト → `==` 比較NG（NaNなども絡む）