# インスタンス化の種類

# Q、

ラッパークラスのインスタンス化の方法はどんな種類がありますか？

はい、Hiroakiさん、

ラッパークラス（`Integer`, `Double`, `Boolean` など）の**インスタンス化の方法**について、網羅的かつ整理された形で解説します。

---

## ✅ ラッパークラスのインスタンス化方法一覧

| 方法 | 書き方 | 特徴／備考 |
| --- | --- | --- |
| ① **リテラルによる代入（推奨）** | `Integer i = 10;` | ✅ **オートボクシング**（`int → Integer`） |
| ② **`valueOf()` メソッド（推奨）** | `Integer i = Integer.valueOf(10);` | ✅ **キャッシュ利用あり（-128～127）→ 高速＆省メモリ** |
| ③ **コンストラクタ（非推奨）** | `Integer i = new Integer(10);` | ❌ **非推奨（Java 9で廃止予定とされた）** |
| ④ **文字列から変換** | `Integer i = Integer.valueOf("10");` | ✅ 文字列からラップ型へ変換（例：パース処理など） |

---

## ✅ それぞれの詳細と違い

---

### ① オートボクシング（自動変換）

```java
Integer i = 10;  // int → Integer に自動変換（autoboxing）
```

- 書きやすくて一般的
- **内部的には `Integer.valueOf()` が呼ばれている**
- `List<Integer>` に `int` を追加するときなども自動で行われる

---

### ② `valueOf()`（最も推奨される明示的な方法）

```java
Integer i = Integer.valueOf(10);
```

- **`128～127` の範囲はキャッシュされている**
    - 同じ値を繰り返し使っても **同じオブジェクトが使い回される**
- **それ以外の値は新規インスタンスが生成される**
- `Boolean.valueOf(true)` や `Double.valueOf("3.14")` も同様に使用可能

### 例：

```java
Integer a = Integer.valueOf(100);
Integer b = Integer.valueOf(100);
System.out.println(a == b); // true（キャッシュ）

Integer c = Integer.valueOf(200);
Integer d = Integer.valueOf(200);
System.out.println(c == d); // false（キャッシュ対象外）
```

---

### ③ コンストラクタ（`new Integer(10)`）※非推奨

```java
Integer i = new Integer(10);
```

- **常に新しいオブジェクトを生成する**
- **キャッシュされない**
- Java 9 以降で非推奨（deprecated）
- **今は使わないことが推奨される**

---

### ④ 文字列からの変換

```java
Integer i = Integer.valueOf("123"); // OK
Integer j = new Integer("123");     // 非推奨
```

- パース処理に便利
- 失敗すると `NumberFormatException` が発生するので注意

---

## ✅ クイックまとめ

| 方法 | 推奨度 | 特徴・用途 |
| --- | --- | --- |
| `Integer i = 10;` | ◎ | 書きやすく自動変換。内部的に `valueOf()` を使う |
| `Integer.valueOf()` | ◎ | 明示的にキャッシュを活用。高速＆省メモリ |
| `new Integer()` | ❌ | 常に新規生成。非推奨（Java 9 で非推奨化） |
| `valueOf(String)` | ○ | パース処理で使う。例外処理に注意 |

---

## 🔍 参考：キャッシュの対象（`Integer`）

```java
Integer.valueOf(-128) ～ Integer.valueOf(127)
```

➡ 上記の範囲はキャッシュされ、**同一オブジェクトとして再利用**されます。

---

## ✅ 補足：プリミティブ⇔ラッパーの変換メソッド

| プリミティブ型 | ラッパークラス | 変換メソッド例 |
| --- | --- | --- |
| `int` | `Integer` | `Integer.valueOf(int)` / `.intValue()` |
| `double` | `Double` | `Double.valueOf(double)` / `.doubleValue()` |
| `boolean` | `Boolean` | `Boolean.valueOf(boolean)` / `.booleanValue()` |

---

ご希望があれば：

- `==` と `.equals()` の比較におけるラッパーの落とし穴
- ボクシングがパフォーマンスに与える影響（大量ループ時など）
- `OptionalInt` など、プリミティブ専用ラッパーAPIの活用方法

も解説できますので、気軽にお声かけください！