# ReentrantLookã‚¯ãƒ©ã‚¹

# Q,

ReentrantLookã«ã¤ã„ã¦è§£èª¬ã—ã¦ãã ã•ã„

ã¯ã„ã€Hiroakiã•ã‚“ã®ã”è³ªå•ã«ãŠç­”ãˆã—ã¦ã€`ReentrantLock` ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚ã“ã‚Œã¯ `java.util.concurrent.locks` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ã€**é«˜æ©Ÿèƒ½ãªæ’ä»–åˆ¶å¾¡ç”¨ãƒ­ãƒƒã‚¯ã‚¯ãƒ©ã‚¹**ã§ã€`synchronized` ã«ä»£ã‚ã‚‹é¸æŠè‚¢ã¨ã—ã¦å®Ÿå‹™ã§éå¸¸ã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚

---

## ğŸ”· ReentrantLock ã¨ã¯ï¼Ÿ

### ğŸ“Œ å®šç¾©ï¼š

> åŒä¸€ã‚¹ãƒ¬ãƒƒãƒ‰ãŒç¹°ã‚Šè¿”ã—ãƒ­ãƒƒã‚¯ã‚’å–å¾—å¯èƒ½ï¼ˆï¼å†å…¥å¯èƒ½ï¼‰ãªæ’ä»–ãƒ­ãƒƒã‚¯ã‚¯ãƒ©ã‚¹
> 
- `synchronized` ã¨åŒã˜ãã€**ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ’ä»–åˆ¶å¾¡**ã™ã‚‹
- ã•ã‚‰ã«ã€**æ˜ç¤ºçš„ãªãƒ­ãƒƒã‚¯/ã‚¢ãƒ³ãƒ­ãƒƒã‚¯**, **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**, **å‰²ã‚Šè¾¼ã¿å¯¾å¿œ**, **ãƒ•ã‚§ã‚¢ãƒã‚¹åˆ¶å¾¡**ãªã©ã®**æŸ”è»Ÿãªæ©Ÿèƒ½**ã‚’æä¾›

---

## âœ… åŸºæœ¬çš„ãªä½¿ã„æ–¹

```java
import java.util.concurrent.locks.ReentrantLock;

public class Counter {
    private final ReentrantLock lock = new ReentrantLock();
    private int count = 0;

    public void increment() {
        lock.lock();           // æ˜ç¤ºçš„ã«ãƒ­ãƒƒã‚¯å–å¾—
        try {
            count++;
        } finally {
            lock.unlock();     // å¿…ãšã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼ï¼ˆä¾‹å¤–é˜²æ­¢ã®ãŸã‚finallyã§ï¼‰
        }
    }

    public int getCount() {
        return count;
    }
}
```

---

## ğŸ” synchronized ã¨ã®é•ã„ã¾ã¨ã‚

| æ¯”è¼ƒé …ç›® | `synchronized` | `ReentrantLock` |
| --- | --- | --- |
| æ›¸ãæ–¹ | ä¿®é£¾å­ï¼ãƒ–ãƒ­ãƒƒã‚¯æ§‹æ–‡ | æ˜ç¤ºçš„ã« `lock()` / `unlock()` |
| å†å…¥å¯èƒ½æ€§ | âœ… å¯èƒ½ | âœ… å¯èƒ½ |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ããƒ­ãƒƒã‚¯ | âŒ ãªã— | âœ… ã‚ã‚Šï¼ˆ`tryLock(timeout)`ï¼‰ |
| å‰²ã‚Šè¾¼ã¿å¯¾å¿œ | âŒ ä¸å¯ | âœ… å¯èƒ½ï¼ˆ`lockInterruptibly()`ï¼‰ |
| å…¬å¹³æ€§ï¼ˆé †ç•ªåˆ¶å¾¡ï¼‰ | âŒ JVMä¾å­˜ | âœ… ãƒ•ã‚§ã‚¢ãƒ¢ãƒ¼ãƒ‰ã‚ã‚Š |
| æ¡ä»¶å¾…ã¡åˆ¶å¾¡ | âŒ `wait()` / `notify()` ã ã‘ | âœ… `Condition` ã«ã‚ˆã‚‹é«˜åº¦ãªåˆ¶å¾¡ |
| å¯èª­æ€§ | ã‚·ãƒ³ãƒ—ãƒ« | ã‚„ã‚„è¤‡é›‘ã ãŒæŸ”è»Ÿ |

---

## ğŸ”¶ ä¸»ãªãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
| --- | --- |
| `lock()` | ãƒ­ãƒƒã‚¯ã‚’å–å¾—ï¼ˆå–å¾—ã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ï¼‰ |
| `unlock()` | ãƒ­ãƒƒã‚¯ã‚’è§£æ”¾ï¼ˆ`try/finally`ã§å¿…ãšè§£æ”¾ï¼‰ |
| `tryLock()` | å³æ™‚ã«ãƒ­ãƒƒã‚¯å–å¾—ã‚’è©¦ã¿ã€æˆåŠŸã™ã‚Œã° true |
| `tryLock(long timeout, TimeUnit unit)` | ä¸€å®šæ™‚é–“å†…ã«ãƒ­ãƒƒã‚¯å–å¾—ã‚’è©¦ã¿ã‚‹ |
| `lockInterruptibly()` | ãƒ­ãƒƒã‚¯å¾…æ©Ÿä¸­ã«å‰²ã‚Šè¾¼ã¿å¯èƒ½ |
| `isLocked()` | ä»–ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚ˆã‚Šãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª |
| `isHeldByCurrentThread()` | ç¾åœ¨ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒãƒ­ãƒƒã‚¯ä¿æŒä¸­ã‹ç¢ºèª |

---

## ğŸ§© ãƒ•ã‚§ã‚¢ãƒ­ãƒƒã‚¯ï¼ˆå…¬å¹³æ€§ï¼‰

### é€šå¸¸ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

```java
new ReentrantLock();  // éãƒ•ã‚§ã‚¢ï¼ˆå‰²ã‚Šè¾¼ã¿OKã€æ€§èƒ½é‡è¦–ï¼‰
```

### ãƒ•ã‚§ã‚¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆå…ˆç€é †ï¼‰

```java
new ReentrantLock(true);  // ãƒ•ã‚§ã‚¢ãƒ­ãƒƒã‚¯ï¼ˆé †ç•ªä¿è¨¼ï¼‰
```

â†’ å¾Œã‹ã‚‰æ¥ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã¯å…ˆã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å¾…ãŸã•ã‚Œãªã„

---

## ğŸ“˜ å†å…¥å¯èƒ½ï¼ˆReentrantï¼‰ã¨ã¯ï¼Ÿ

```java
lock.lock();
try {
    methodA();  // ã“ã®ä¸­ã§ã¾ãŸ lock.lock() ã—ã¦ã‚‚å•é¡Œãªã—
} finally {
    lock.unlock();
}
```

â†’ **åŒä¸€ã‚¹ãƒ¬ãƒƒãƒ‰ãŒä½•åº¦ lock() ã—ã¦ã‚‚ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œãšã«å†å…¥ã§ãã‚‹**

---

## ğŸ” æ¡ä»¶å¤‰æ•°ï¼ˆ`Condition`ï¼‰ã¨ã®é€£æº

`synchronized` ã® `wait()` / `notify()` ã«ç›¸å½“ã™ã‚‹æ©Ÿèƒ½

```java
Lock lock = new ReentrantLock();
Condition condition = lock.newCondition();

lock.lock();
try {
    condition.await();       // å¾…æ©Ÿ
    condition.signal();      // ã‚·ã‚°ãƒŠãƒ«é€ä¿¡
} finally {
    lock.unlock();
}
```

â†’ ã‚ˆã‚Šç´°ã‹ã**è¤‡æ•°ã®å¾…æ©Ÿæ¡ä»¶ã‚’åˆ†ã‘ã¦ç®¡ç†**ã§ãã‚‹ç‚¹ãŒå¼·ã¿ã§ã™ã€‚

---

## ğŸ”š ã¾ã¨ã‚

| ç‰¹æ€§ | å†…å®¹ |
| --- | --- |
| ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ• | âœ… æ’ä»–åˆ¶å¾¡ã«ä½¿ç”¨ã§ãã‚‹ |
| å†å…¥å¯èƒ½ | âœ… åŒä¸€ã‚¹ãƒ¬ãƒƒãƒ‰ãŒä½•åº¦ã§ã‚‚ lock() ã§ãã‚‹ |
| æ˜ç¤ºçš„åˆ¶å¾¡ | âœ… `lock()` / `unlock()` å¿…é ˆï¼ˆtry-finallyæ¨å¥¨ï¼‰ |
| æŸ”è»Ÿæ€§ | âœ… ãƒ•ã‚§ã‚¢åˆ¶å¾¡ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»å‰²ã‚Šè¾¼ã¿å¯¾å¿œãŒå¯èƒ½ |
| å¯¾è±¡ç”¨é€” | é«˜åº¦ãªã‚¹ãƒ¬ãƒƒãƒ‰åˆ¶å¾¡ãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ï¼ˆæ¡ä»¶åˆ†å²ã€åˆ¶å¾¡ã®åˆ†é›¢ãªã©ï¼‰ |

---

ã”å¸Œæœ›ãŒã‚ã‚Œã°ã€`synchronized` ã‚’ `ReentrantLock` ã«æ›¸ãæ›ãˆã‚‹æ¼”ç¿’å•é¡Œã‚„ã€`Condition` ã‚’ä½¿ã£ãŸå¾…æ©Ÿãƒ»é€šçŸ¥ãƒ¢ãƒ‡ãƒ«ã®ä¾‹ã‚‚ã”ç´¹ä»‹ã§ãã¾ã™ï¼

# Q,

Runnableã‚„Callableã«ã¦ï¼‘ã¤ï¼‘ã¤ã®å‡¦ç†ã‚’å®šç¾©ã—ã¦ã„ãŸã¨ã“ã‚ã€ReentrantLookã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼‘ã¤ï¼‘ã¤å®šç¾©ã—ã¦ã„ãŸå‡¦ç†ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã¾ã¨ã‚ã¦åˆ¶å¾¡ã§ãã‚‹ã“ã¨ã¨ã€å‡¦ç†ã®ç‰¹å®šæ€§ã®ã‚ˆã†ãªã¨ã“ã‚ã§æ··ä¹±ã—ã¦ã„ã¾ã™ã€‚

ã¨ã¦ã‚‚é‹­ã„ã”è³ªå•ã§ã™ã€‚Hiroakiã•ã‚“ã®æ··ä¹±ã¯è‡ªç„¶ãªã‚‚ã®ã§ã€ã€Œ**Runnable / Callable ã«ã‚ˆã‚‹å‡¦ç†ã®â€œç²’åº¦â€**ã¨ã€**ReentrantLock ã«ã‚ˆã‚‹â€œåˆ¶å¾¡ã®å˜ä½â€**ã€ãŒé ­ã®ä¸­ã§é‡ãªã£ã¦è¦‹ãˆã¦ã„ã‚‹çŠ¶æ…‹ã ã¨æ€ã„ã¾ã™ã€‚

ãã“ã§ä»¥ä¸‹ã«ã€**ä¸¡è€…ã®å½¹å‰²ã¨ä½¿ã„åˆ†ã‘**ã‚’æ˜ç¢ºã«æ•´ç†ã—ã¾ã™ã€‚

---

## ğŸ”· çµè«–ã®å…ˆå–ã‚Š

> âœ… **Runnable / Callable ã¯ã€Œä½•ã‚’ã™ã‚‹ã‹ï¼ˆå‡¦ç†ã®å®šç¾©ï¼‰ã€<br>
> 
> 
> âœ… **ReentrantLock ã¯ã€Œ**ã©ã®ç¯„å›²ã‚’æ’ä»–åˆ¶å¾¡ã™ã‚‹ã‹ï¼ˆå®Ÿè¡Œã®åˆ¶å¾¡ï¼‰**ã€
> 

---

## ğŸ”¸ã€1ã€‘Runnable / Callableï¼šå‡¦ç†ã®å˜ä½ã‚’å®šç¾©

- **å½¹å‰²**ï¼šã‚¹ãƒ¬ãƒƒãƒ‰ã§ä¸¦è¡Œå®Ÿè¡Œã•ã›ã‚‹ã€Œå‡¦ç†ã®ä¸­èº«ã€ã‚’å®šç¾©
- `Runnable` â†’ æˆ»ã‚Šå€¤ãªã—ï¼ˆ`void run()`ï¼‰
- `Callable<T>` â†’ æˆ»ã‚Šå€¤ã‚ã‚Šï¼ˆ`T call()`ï¼‰

### âœ… ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š

```java
Runnable task = () -> {
    System.out.println("å‡¦ç†A");
};
executor.submit(task);
```

â†’ ã€Œå‡¦ç†Aã€ã¨ã„ã†**ã‚„ã‚‹ã“ã¨ãã®ã‚‚ã®**ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã€‚

---

## ğŸ”¸ã€2ã€‘ReentrantLockï¼šå®Ÿè¡Œæ™‚ã®æ’ä»–åˆ¶å¾¡ã‚’è¡Œã†

- **å½¹å‰²**ï¼š**ã©ã®å‡¦ç†ãŒåŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã¦ã¯ã„ã‘ãªã„ã‹ã‚’åˆ¶å¾¡**
- ã€Œã“ã®ç¯„å›²ã¯ä»–ã‚¹ãƒ¬ãƒƒãƒ‰ã¨åŒæ™‚å®Ÿè¡Œç¦æ­¢ã€ã¨ã™ã‚‹ãŸã‚ã«ä½¿ã†

### âœ… ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š

```java
ReentrantLock lock = new ReentrantLock();

Runnable task = () -> {
    lock.lock();
    try {
        System.out.println("æ’ä»–å‡¦ç†A");
    } finally {
        lock.unlock();
    }
};
```

â†’ åŒã˜ `lock` ã‚’å…±æœ‰ã—ã¦ã„ã‚Œã°ã€**ã“ã®ä¸­ã®å‡¦ç†ã¯1ã‚¹ãƒ¬ãƒƒãƒ‰ãšã¤ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„**

---

## âœ… ã§ã¯ã€Œã¾ã¨ã‚ã‚‰ã‚Œã‚‹ã€ã¨ã¯ã©ã†ã„ã†æ„å‘³ã‹ï¼Ÿ

### âŒ èª¤è§£ã•ã‚Œã‚„ã™ã„ç‚¹ï¼š

ã€ŒReentrantLock ã‚’ä½¿ã†ã¨ Runnable ã‚’ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ï¼Ÿã€

â†’ ã“ã‚Œã¯ **Runnableã‚’â€œ1ã¤ã«åˆæˆã§ãã‚‹â€ã¨ã„ã†è©±ã§ã¯ãªã**ã€

### âœ… æ­£ç¢ºã«ã¯ï¼š

> è¤‡æ•°ã® Runnable / Callable ã®ä¸­ã®ã€Œå…±é€šã®ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ’ä»–é ˜åŸŸï¼‰ã€ã‚’ã²ã¨ã¾ã¨ã‚ã«åˆ¶å¾¡ã§ãã‚‹
> 

---

### ğŸ” ä¾‹ï¼šReentrantLock ã«ã‚ˆã£ã¦åˆ¶å¾¡ã•ã‚Œã‚‹ç²’åº¦ã‚’æƒãˆã‚‹

```java
public class SharedResource {
    private final ReentrantLock lock = new ReentrantLock();

    public void write() {
        lock.lock();
        try {
            // æ›¸ãè¾¼ã¿å‡¦ç†A
        } finally {
            lock.unlock();
        }
    }

    public void update() {
        lock.lock();
        try {
            // æ›¸ãè¾¼ã¿å‡¦ç†B
        } finally {
            lock.unlock();
        }
    }
}
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ï¼š

- `Runnable taskA = () -> shared.write();`
- `Runnable taskB = () -> shared.update();`

ã¨ã„ã† **ç•°ãªã‚‹ Runnable ã«ã¾ãŸãŒã‚‹å‡¦ç†**ã‚‚ã€**åŒã˜ lock ã‚’ä½¿ãˆã°ä¸€è²«ã—ã¦æ’ä»–åˆ¶å¾¡ã§ãã‚‹**

---

## âœ… ã¾ã¨ã‚ï¼šå½¹å‰²ã®é•ã„

| è¦ç´  | ä¸»ãªå½¹å‰² | å¯¾è±¡ | æ’ä»–åˆ¶å¾¡ã¨ã®é–¢ä¿‚ |
| --- | --- | --- | --- |
| `Runnable` / `Callable` | å‡¦ç†ã®å®šç¾©ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œï¼‰ | ã©ã‚“ãªå‡¦ç†ã‚’ã™ã‚‹ã‹ | æ’ä»–åˆ¶å¾¡ã¯å«ã¾ãªã„ï¼ˆè¨­è¨ˆã«ã‚ˆã‚Šå¤–ã‹ã‚‰ä»˜ã‘ã‚‹ï¼‰ |
| `ReentrantLock` | å®Ÿè¡Œæ™‚ã®åŒæ™‚ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ã | ã©ã®ç¯„å›²ã‚’ä¿è­·ã™ã‚‹ã‹ | ä¿è­·å¯¾è±¡ã‚’ `lock()` / `unlock()` ã§å›²ã‚€ |

---

## ğŸ’¡ å®Ÿå‹™ã®è¨­è¨ˆçš„è¦–ç‚¹ï¼ˆæ··ä¹±ã‚’é˜²ããŸã‚ã®è£œè¶³ï¼‰

- **Runnable / Callable = ã€Œãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€**
- **ReentrantLock = ã€Œãƒ«ãƒ¼ãƒ«ï¼ˆ1äººãšã¤ãƒ—ãƒ¬ã‚¤ï¼‰ã€**

å‡¦ç†ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ã‚’å¤šæ•°ç”¨æ„ã—ãŸä¸Šã§ã€ã€Œã“ã®ã‚¨ãƒªã‚¢ã¯åŒæ™‚ã«1äººã ã‘å…¥ã‚Œã‚‹ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã‚’ ReentrantLock ã§å®Ÿç¾ã™ã‚‹ã€‚

---

ã”å¸Œæœ›ã‚ã‚Œã°ã€ã€Œè¤‡æ•°ã‚¿ã‚¹ã‚¯ã‚’æ’ä»–åˆ¶å¾¡ä»˜ãã§å®Ÿè¡Œã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚‚æç¤ºå¯èƒ½ã§ã™ï¼

# Q,

ã‚¯ãƒ©ã‚¹ã‚’æ–°è¦ä½œæˆã—ã¦ã€ReentrantLookã‚’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ³¨å…¥ã—ã¦ä½¿ç”¨ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã—ã‚‡ã†ã‹ï¼Ÿ
è²¬ä»»åˆ†æ‹…ã®è¦³ç‚¹ã‹ã‚‰ã€‚

ã¯ã„ã€Hiroakiã•ã‚“ã®ã”èªè­˜ã¯**éå¸¸ã«è‰¯ã„è¨­è¨ˆå¿—å‘ã«åŸºã¥ã„ãŸã‚‚ã®**ã§ã€**æ­£ã—ã„æ–¹å‘æ€§**ã§ã™ã€‚

çµè«–ã‹ã‚‰è¨€ã†ã¨ï¼š

> âœ… ReentrantLock ã¯ã€Œå…±æœ‰ã™ã¹ãæ’ä»–åˆ¶å¾¡ã®è²¬ä»»ç¯„å›²ã€ã«åˆã‚ã›ã¦ã€ã‚¯ãƒ©ã‚¹å†…ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦æŒã¤è¨­è¨ˆãŒä¸€èˆ¬çš„ã§ã™ã€‚
> 

ã“ã‚Œã¯ã€**æ’ä»–åˆ¶å¾¡ã®è²¬ä»»ã‚’ãã®ã‚¯ãƒ©ã‚¹è‡ªèº«ãŒè² ã†**ã¨ã„ã†ã“ã¨ã§ã‚‚ã‚ã‚Šã€**ã‚«ãƒ—ã‚»ãƒ«åŒ–ãƒ»è²¬å‹™åˆ†æ‹…ã®åŸå‰‡ï¼ˆSRPï¼‰**ã«é©ã£ãŸè¨­è¨ˆã§ã™ã€‚

---

## ğŸ”· ã‚¤ãƒ¡ãƒ¼ã‚¸å›³

```java
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SharedResourceã‚¯ãƒ©ã‚¹ â”‚ â† è²¬å‹™ï¼šãƒªã‚½ãƒ¼ã‚¹æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + lock: ReentrantLock â”‚ â† æ’ä»–åˆ¶å¾¡ã‚’ã“ã®ã‚¯ãƒ©ã‚¹ã§å®Œçµ
â”‚ + write()             â”‚
â”‚ + update()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… å®Ÿè£…ä¾‹

```java
import java.util.concurrent.locks.ReentrantLock;

public class SharedResource {
    private final ReentrantLock lock = new ReentrantLock();

    public void write() {
        lock.lock();
        try {
            System.out.println("Writing...");
            // ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        } finally {
            lock.unlock();
        }
    }

    public void update() {
        lock.lock();
        try {
            System.out.println("Updating...");
        } finally {
            lock.unlock();
        }
    }
}
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ï¼š

- `ReentrantLock` ã¯ **å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã™ã‚‹ã®ã§ã¯ãªãã€å†…éƒ¨ã®è²¬ä»»ã¨ã—ã¦ã‚¯ãƒ©ã‚¹ãŒæŒã¤**ï¼ˆè‡ªå¾‹æ€§ã®ç¢ºä¿ï¼‰
- ä½¿ç”¨è€…å´ï¼ˆRunnableãªã©ï¼‰ã¯ `resource.write()` ã®ã‚ˆã†ã«å‘¼ã³å‡ºã™ã ã‘ã§ã‚ˆã„ï¼ˆå‘¼ã³å‡ºã—å…ƒã¯ãƒ­ãƒƒã‚¯ã®å­˜åœ¨ã‚’æ„è­˜ã—ãªã„ï¼‰

---

## ğŸ”„ ã§ã¯ã€Œæ³¨å…¥ã€ã®è©±ã¯ã©ã†ãªã‚‹ã‹ï¼Ÿ

### âœ… å¤–éƒ¨ã‹ã‚‰ `ReentrantLock` ã‚’æ³¨å…¥ã™ã‚‹è¨­è¨ˆã‚‚å¯èƒ½ã§ã™ã€‚

ã“ã‚Œã¯ã€Œ**ãƒ­ãƒƒã‚¯ã®ç²’åº¦ã‚’è·¨ã„ã§å…±æœ‰ã—ãŸã„å ´åˆ**ã€ã«æ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚

### ä¾‹ï¼šè¤‡æ•°ã®ã‚¯ãƒ©ã‚¹ã«ã¾ãŸãŒã£ã¦åŒã˜ãƒ­ãƒƒã‚¯ã§æ’ä»–ã—ãŸã„

```java
public class ResourceA {
    private final ReentrantLock lock;

    public ResourceA(ReentrantLock lock) {
        this.lock = lock;
    }

    public void doA() {
        lock.lock();
        try {
            System.out.println("A...");
        } finally {
            lock.unlock();
        }
    }
}

public class ResourceB {
    private final ReentrantLock lock;

    public ResourceB(ReentrantLock lock) {
        this.lock = lock;
    }

    public void doB() {
        lock.lock();
        try {
            System.out.println("B...");
        } finally {
            lock.unlock();
        }
    }
}
```

```java
ReentrantLock sharedLock = new ReentrantLock();
ResourceA a = new ResourceA(sharedLock);
ResourceB b = new ResourceB(sharedLock);
```

â†’ Aã¨BãŒ**åŒæ™‚ã«æ“ä½œã•ã‚Œã‚‹ã¨ç«¶åˆã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹**ã§ã‚ã‚Œã°ã€ã“ã®ã‚ˆã†ã«**ãƒ­ãƒƒã‚¯ã‚’æ³¨å…¥ã—ã¦å…±æœ‰**ã™ã‚‹è¨­è¨ˆã‚‚å¦¥å½“ã§ã™ã€‚

---

## ğŸ çµè«–ï¼šè²¬ä»»åˆ†æ‹…ã®åŸå‰‡ã«å¾“ã£ãŸé¸æŠ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | é¸ã¶ã¹ãå ´é¢ | è¨­è¨ˆæ„å›³ |
| --- | --- | --- |
| **ã‚¯ãƒ©ã‚¹å†…éƒ¨ã«æŒã¤** | ãã®ã‚¯ãƒ©ã‚¹å˜ç‹¬ã§ãƒªã‚½ãƒ¼ã‚¹æ“ä½œã‚’å®Œçµã™ã‚‹ | æ’ä»–åˆ¶å¾¡ã‚‚ã‚¯ãƒ©ã‚¹ã®è²¬ä»»ã¨ã—ã¦é–‰ã˜ã‚‹ï¼ˆSRPï¼‰ |
| **å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã™ã‚‹** | è¤‡æ•°ã‚¯ãƒ©ã‚¹ã‚„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ãƒ­ãƒƒã‚¯å…±æœ‰ | æ’ä»–åˆ¶å¾¡ã®ç²’åº¦ã‚’ã¾ãŸã„ã§å…±æœ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ |

---

ã”å¸Œæœ›ã‚ã‚Œã°ã€Œæ’ä»–åˆ¶å¾¡ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå†…åŒ…å‹ï¼æ³¨å…¥å‹ï¼‰ã€ã‚’æ•´ç†ã—ãŸæ¯”è¼ƒè¡¨ï¼‹å›³è§£ã‚‚ã”æä¾›ã—ã¾ã™ï¼