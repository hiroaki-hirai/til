# æ•´åˆæ€§ã¨è¡çªæ™‚ã®ãƒã‚°ä¾‹

`equals` / `hashCode` / `compareTo` ã®**æ•´åˆæ€§**ã¯ã€Javaã§ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ“ä½œï¼ˆSetã€Mapã€TreeSet ãªã©ï¼‰ã‚„ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å‹•ä½œã«ã¨ã£ã¦**æ¥µã‚ã¦é‡è¦**ã§ã™ã€‚

ã“ã“ã§ã¯ã€**æ•´åˆæ€§ãƒ«ãƒ¼ãƒ« â†’ å´©ã‚ŒãŸã¨ãã®ãƒã‚°ä¾‹ â†’ ãªãœèµ·ã“ã‚‹ã‹** ã‚’æ®µéšçš„ã«è§£èª¬ã—ã¾ã™ã€‚

---

## âœ… 1. å„ãƒ¡ã‚½ãƒƒãƒ‰ã®ç›®çš„ã¨ä½¿ã‚ã‚Œæ–¹

| ãƒ¡ã‚½ãƒƒãƒ‰ | ä½¿ã‚ã‚Œã‚‹å ´é¢ | ç›®çš„ |
| --- | --- | --- |
| `equals()` | Setã€Mapã€List ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ | ã€ŒåŒä¸€ã®æ„å‘³ã‚’æŒã¤ã‹ï¼Ÿã€ã‚’åˆ¤æ–­ï¼ˆç­‰ä¾¡æ€§ï¼‰ |
| `hashCode()` | HashSetã€HashMap ã®ãƒã‚±ãƒƒãƒˆåˆ†é… | `equals()` ãŒ true ãªã‚‰åŒã˜ hashCode ã« |
| `compareTo()` | TreeSetã€TreeMapã€Collections.sort | ã€Œé †åºé–¢ä¿‚ã€ã®åˆ¤å®šï¼ˆé †åºæ€§ï¼‰ |

---

## âœ… 2. åŸºæœ¬ãƒ«ãƒ¼ãƒ«ï¼šæ•´åˆæ€§ã®åŸå‰‡

### â˜‘ï¸ åŸå‰‡1ï¼šequals ã¨ hashCode ã¯ **æ•´åˆ** ã™ã¹ã—

```java
if (a.equals(b)) then a.hashCode() == b.hashCode()
```

â†’ ã“ã‚Œã‚’ç ´ã‚‹ã¨ `HashSet` ã§åŒä¸€è¦ç´ ãŒé‡è¤‡ç™»éŒ²ã•ã‚Œã‚‹ãªã©ã®**é‡å¤§ãƒã‚°**ã«ãªã‚Šã¾ã™ã€‚

---

### â˜‘ï¸ åŸå‰‡2ï¼šequals ã¨ compareTo ã¯ **ä¸€è²«æ€§ã‚’æŒã¤ã¹ã**

```java
if (a.compareTo(b) == 0) then a.equals(b) == true
```

â†’ ã“ã‚Œã‚’ç ´ã‚‹ã¨ `TreeSet` ã‚„ `TreeMap` ã§ã€Œè¦‹ãŸç›®ã«ã¯åŒã˜ãƒ‡ãƒ¼ã‚¿ã€ãŒ**é‡è¤‡ã—ã¦æ ¼ç´ã•ã‚Œã‚‹**ã‚ˆã†ãªãƒã‚°ãŒèµ·ãã¾ã™ã€‚

---

## â— æ•´åˆæ€§ãŒå´©ã‚ŒãŸã¨ãã®ãƒã‚°ä¾‹

---

### ğŸ”» ä¾‹1ï¼šequals ã¯ true ãªã®ã« compareTo ã¯ 0 ã§ãªã„

```java
class Person implements Comparable<Person> {
    String name;
    int age;

    Person(String name, int age) { this.name = name; this.age = age; }

    @Override
    public boolean equals(Object o) {
        if (o instanceof Person p) {
            return this.name.equals(p.name); // â† nameã ã‘ã§ç­‰ä¾¡åˆ¤å®š
        }
        return false;
    }

    @Override
    public int hashCode() {
        return Objects.hash(name);
    }

    @Override
    public int compareTo(Person o) {
        return Integer.compare(this.age, o.age); // â† ageã§æ¯”è¼ƒ
    }
}
```

### âŒ å•é¡Œç‚¹

- `equals()` â†’ åŒã˜åå‰ãªã‚‰åŒä¸€ã¨åˆ¤å®š
- `compareTo()` â†’ å¹´é½¢ã§é †åºã‚’åˆ¤å®š

```java
TreeSet<Person> set = new TreeSet<>();
set.add(new Person("Alice", 20));
set.add(new Person("Alice", 25));
System.out.println(set.size()); // 2 â† åå‰ã¯åŒã˜ãªã®ã«é‡è¤‡ãŒè¨±ã•ã‚Œã‚‹
```

### ğŸ”´ çµæœï¼š

`TreeSet` ã¯ `compareTo` ã‚’ä½¿ã£ã¦é‡è¤‡åˆ¤æ–­ â†’ 20 â‰  25 â†’ **ä¸¡æ–¹å…¥ã‚‹**

---

### ğŸ”» ä¾‹2ï¼šcompareTo == 0 ãªã®ã« equals ãŒ false

```java
class IdOnly implements Comparable<IdOnly> {
    int id;

    IdOnly(int id) { this.id = id; }

    public int compareTo(IdOnly o) {
        return Integer.compare(this.id, o.id); // æ¯”è¼ƒã¯ ID
    }

    public boolean equals(Object o) {
        return false; // å¸¸ã« false â† æ•´åˆæ€§ãªã—
    }
}
```

### âŒ çµæœï¼š

```java
TreeSet<IdOnly> set = new TreeSet<>();
set.add(new IdOnly(1));
set.add(new IdOnly(1));
System.out.println(set.size()); // 1 â†’ TreeSetã§ã¯ç‰‡æ–¹ã—ã‹æ®‹ã‚‰ãªã„
System.out.println(set.contains(new IdOnly(1))); // false â† equals ãŒ false ã ã‹ã‚‰è¦‹ã¤ã‘ã‚‰ã‚Œãªã„
```

â†’ **contains() ãŒæœŸå¾…é€šã‚Šå‹•ä½œã—ãªã„ãƒã‚°**ã«ç¹‹ãŒã‚Šã¾ã™ã€‚

---

## âœ… æ­£ã—ã„æ•´åˆã®å®šç¾©ä¾‹

```java
class User implements Comparable<User> {
    String name;

    public boolean equals(Object o) {
        if (o instanceof User u) {
            return this.name.equals(u.name);
        }
        return false;
    }

    public int hashCode() {
        return Objects.hash(name);
    }

    public int compareTo(User o) {
        return this.name.compareTo(o.name); // ç­‰ä¾¡æ¡ä»¶ã¨åŒã˜é …ç›®ã§æ¯”è¼ƒ
    }
}
```

---

## âœ… ã¾ã¨ã‚

| æ•´åˆæ€§ã®çµ„ã¿åˆã‚ã› | å¿…é ˆåº¦ | ç ´ã‚‹ã¨èµ·ã“ã‚‹ã“ã¨ |
| --- | --- | --- |
| equals ã¨ hashCode | å¿…é ˆ | HashSet ã§é‡è¤‡ç®¡ç†ãŒå£Šã‚Œã‚‹ |
| compareTo ã¨ equals | æ¨å¥¨ | TreeSet ã§ã€Œç­‰ã—ã„ã¯ãšã®å€¤ã€ãŒé‡è¤‡ã™ã‚‹ |
| compareTo ã®ä¸€è²«æ€§ | å¿…é ˆ | Collections.sort ã§é †åºãŒå£Šã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Š |

---

## ã”å¸Œæœ›ã«å¿œã˜ã¦ï¼š

- `compareTo` ã®ã€Œåå¯¾ç§°æ€§ã€ã€Œæ¨ç§»æ€§ã€é•åã®ä¾‹
- `SortedMap` ã‚„ `SortedSet` å®Ÿè£…ã«ãŠã‘ã‚‹ equals ã¨ compareTo ã®å®Ÿå‹™çš„åˆ¤æ–­

ãªã©ã‚‚æ•´ç†ã§ãã¾ã™ã€‚