# 導入

# Q,

例外のアサーションについて解説してください。

Hiroakiさん、良い質問です。

「例外のアサーション」と聞くと少し抽象的に感じるかもしれませんが、これは主に以下の２つの文脈で使われます：

---

## ✅ 1. **テストにおける「例外のアサーション」**（JUnitなど）

> 👉 「あるコードが例外をスローすることを確認する」ための検証（アサーション）
> 

---

### 🔸 例：JUnit5 の `assertThrows()`

```java
import static org.junit.jupiter.api.Assertions.*;

@Test
void testDivideByZero() {
    ArithmeticException e = assertThrows(
        ArithmeticException.class,
        () -> divide(10, 0)  // ここで例外が発生することを期待
    );
    assertEquals("/ by zero", e.getMessage());
}
```

- `assertThrows()` は例外が**スローされることを期待して成功とする**。
- スローされなければテスト失敗。
- スローされたら、**その例外オブジェクト（e）を検査できる**。

---

### ✅ テストにおける例外アサーションの目的

| 項目 | 内容 |
| --- | --- |
| テストの信頼性 | **期待通りに例外が発生する**ことを確認できる |
| バグの早期発見 | 例外が発生しなかった or 想定外の例外が発生したときに検出できる |
| ドキュメントの代わり | 「この入力にはこの例外が出る」と明示的に記述できる |

---

### 🔸 他の例（JUnit4 / AssertJ）

### JUnit4（古い書き方）

```java
@Rule
public ExpectedException thrown = ExpectedException.none();

@Test
public void testException() {
    thrown.expect(IllegalArgumentException.class);
    thrown.expectMessage("Invalid ID");
    myService.validate(null);
}
```

AssertJ（より自然な表現）

```java
assertThatThrownBy(() -> myService.validate(null))
    .isInstanceOf(IllegalArgumentException.class)
    .hasMessage("Invalid ID");
```

---

## ✅ 2. **Java本体における「アサーション（`assert`）での例外検出」**

> 👉 Javaの assert 文を使って、期待が崩れた場合に AssertionError をスローする
> 

---

### 🔸 例：`assert` による簡易チェック

```java
int x = -1;
assert x >= 0 : "x must not be negative"; // ← falseなら AssertionError 発生
```

- 実行時に `-ea`（enable assertions）オプションを付けないと機能しない：

```java
java -ea Main
```

- `assert` に失敗すると、**例外（`AssertionError`）がスローされる**
- テストや開発環境での**前提条件チェックや契約プログラミングの補助**として使われる

---

## ✅ 両者の違いまとめ

| 項目 | テストにおける例外アサーション | `assert` による例外発生 |
| --- | --- | --- |
| 用途 | **例外が発生することを検証する**（テスト） | **前提条件が崩れたときに明示的に例外をスロー** |
| 使用場所 | JUnitなどのテストコード | 本番コード（ただし主に開発・検証用途） |
| 例外型 | 任意（例：`IllegalArgumentException`） | `AssertionError` 固定 |
| 実行制御 | 常に動作 | `-ea` オプションが必要 |

---

## 🔚 まとめ

- *「例外のアサーション」**とは主に：
    - ✔️ **テストで例外が発生することを期待して確認する処理**
    - ✔️ または Java の `assert` を使って「条件が false のとき例外を投げる」処理
- `assertThrows()` や `assertThatThrownBy()` などを活用すると、**堅牢で明示的なテストが書ける**

---

ご希望があれば、JUnit5ベースでの「例外のアサーションパターン集」や、「独自例外クラスに対するアサーション」などもご紹介できます！