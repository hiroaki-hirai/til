# opens

# Q,

モジュールシステムにおいては、基本リフレクションの使用はできず、opens ディレクティブで指定したパッケージのみリフレクション可能とすることができる認識はあっていますか？

はい、**その認識は正しいです**。

ただし、もう少し正確に表現すると、Javaの**モジュールシステム（JPMS：Java Platform Module System）**では、以下のような制限と制御が行われます。

---

## ✅ 結論：

> 基本的にモジュール外からのリフレクションアクセスは制限されており、opens ディレクティブを使って明示的に許可しない限り使用できません。
> 

---

## 🔍 詳細説明

### 🔒 デフォルトの制限

モジュールを定義する `module-info.java` が存在する場合、そのモジュールのパッケージは…

| アクセス手段 | デフォルトの挙動 |
| --- | --- |
| **通常のコードアクセス（publicクラスなど）** | `exports` によって公開されたパッケージに対してのみ可能 |
| **リフレクションアクセス（Field#setAccessible など）** | **`opens` によって開かれたパッケージのみ**可能 |

---

### 📘 ディレクティブの違い

| ディレクティブ | 意味 | アクセス対象 | リフレクション可否 |
| --- | --- | --- | --- |
| `exports パッケージ名;` | 他モジュールから通常アクセスを許可 | `public` クラス、メソッドなど | ❌ 通常のリフレクションは不可 |
| `opens パッケージ名;` | リフレクションを含めてアクセス許可 | 全体 | ✅ 可 |
| `opens パッケージ名 to 他モジュール名;` | 指定モジュールにのみリフレクション許可 | 指定モジュールのみ | ✅ 可（限定） |
| `exports パッケージ名 to 他モジュール名;` | 通常アクセスを特定モジュールにのみ許可 | 指定モジュールのみ | ❌ リフレクション不可 |

---

### 🧪 例：module-info.java

```java
module com.example.myapp {
    exports com.example.api;                       // 通常のアクセスだけ許可
    opens com.example.internal to com.fasterxml.jackson.databind; // リフレクション専用の公開
}
```

この場合…

- `com.example.api` → 他モジュールから**通常アクセス可**（リフレクション不可）
- `com.example.internal` → Jackson などに**リフレクション可**

---

### ⚠️ 注意点

- `opens` はセキュリティ上、**最小限にとどめるのが原則**。
- Java 9 以降、**リフレクションベースのライブラリ（Jackson, Hibernate, Spring など）**は `opens` に依存するケースが多くなっています。

---

## ✅ まとめ

| 観点 | 内容 |
| --- | --- |
| デフォルトでは？ | 他モジュールからのリフレクションは**ブロック**される |
| リフレクションを許可するには？ | `opens` を使って、明示的にパッケージを開く必要がある |
| `exports` との違いは？ | `exports` は通常のコードアクセス向け、`opens` はリフレクションアクセス向け |