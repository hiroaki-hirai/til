# モジュールシステム

[導入](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/%E5%B0%8E%E5%85%A5%2023562cef7350807cb714ed8b499e99a9.md)

[mods](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/mods%2023562cef735080699f19da9a6894cb83.md)

# Q,

モジュールシステムの全体像を解説してください。

もちろんです！

ここでは Java 9 以降で導入された **モジュールシステム（JPMS: Java Platform Module System）** の**全体像**を、段階的にかみ砕いて解説します。

---

## 🔷 モジュールシステムとは？

### 👉 一言でいうと：

Javaプログラムを**論理的な単位（モジュール）に分けて、依存関係と公開範囲を明示的に管理**する仕組みです。

---

## 🔶 なぜ導入されたのか？（背景）

| 問題（従来） | モジュールシステムでの改善 |
| --- | --- |
| クラスパスの肥大・衝突（JAR地獄） | `requires` による依存の明示 |
| APIの隠蔽が困難 | `exports` による公開パッケージの指定 |
| 起動JARサイズの最適化が難しい | `jlink` による最小ランタイムの作成 |
| セキュリティ・保守性の課題 | 内部APIの隠蔽とアクセス制御の強化 |

---

## 🔷 モジュールの定義

### 🔸 1. `module-info.java` ファイル

各モジュールのルートに置く定義ファイルです。

以下のような構文で、**依存関係**と**公開範囲**を明示します：

```java
module com.example.myapp {
    requires java.sql;
    exports com.example.myapp.service;
}
```

---

## 🔷 モジュールシステムの構成要素

| 要素 | 説明 |
| --- | --- |
| **モジュール（module）** | 一連のパッケージのまとまり。`module-info.java` で定義される。 |
| **`requires`** | 依存する他のモジュールを指定（例: `requires java.sql`） |
| **`exports`** | 外部モジュールに公開するパッケージを指定 |
| **`opens`** | リフレクションアクセス用のパッケージ公開（Springなどで使う） |
| **`uses` / `provides`** | サービスプロバイダ機構（`ServiceLoader`）での依存と提供の宣言 |

---

## 🔷 モジュールの種類（3つの区分）

| 種類 | 内容 |
| --- | --- |
| **Named Module** | `module-info.java` を含むモジュール |
| **Automatic Module** | JARに `module-info.java` はないが、自動的にモジュールと認識される |
| **Unnamed Module** | クラスパスで読み込まれる、従来のJavaコード |

---

## 🔷 Java標準APIもモジュール化されている

| モジュール名 | 役割例 |
| --- | --- |
| `java.base` | すべてのモジュールが依存（暗黙） |
| `java.sql` | JDBC関連API |
| `java.xml` | XMLパーサーやDOM関連 |

---

## 🔷 モジュールグラフと依存解決

モジュールシステムは**モジュール間の依存関係をグラフとして管理**します。

この依存グラフにより、以下が可能になります：

- 未使用モジュールの除去
- 循環依存の検出
- 意図しない依存の防止

---

## 🔷 モジュールシステムの利点まとめ

| 項目 | 効果 |
| --- | --- |
| ✅ カプセル化強化 | 内部クラスを隠すことで、堅牢な設計が可能に |
| ✅ 依存の明示 | どのモジュールが何に依存しているか明確 |
| ✅ セキュリティ向上 | 不正なアクセスを未然に防げる |
| ✅ 起動時間短縮 | 不要モジュールを除外できる |
| ✅ 軽量JRE構築 | `jlink` によってカスタムJREが作れる |

---

## 🔷 モジュールシステムが**不要/過剰**な場面もある

| 状況 | 説明 |
| --- | --- |
| 小規模アプリケーション | クラスパスで十分。モジュール化による効果は限定的。 |
| Spring BootやMaven主導の開発 | 多くがモジュール非対応。classpath モードが主流。 |

---

## 🔷 全体イメージ図（簡易）

```java
   [Main App Module]
          |
    ┌─────┴───────┐
[Module A]     [Module B]
     |               |
[Java.sql]      [Java.logging]
```

- 矢印：`requires`
- モジュールごとに独立した「境界」がある

---

## ✳️ まとめ：モジュールシステムの全体像

| ポイント | 内容 |
| --- | --- |
| 目的 | カプセル化、依存制御、最適化、安全性の強化 |
| 中心構文 | `module-info.java` による宣言的な設計 |
| 開発現場での使いどころ | ライブラリ開発、JDK最適化、セキュアな設計が求められる場合など |
| 使わない選択もOK | 通常の開発やSpringベースの構成では使わずに済むことも多い |

---

必要であれば、以下の補足もできます：

- `module-info.java` を含む最小構成プロジェクト
- `jlink` を使ったカスタムJREの作成例
- モジュールシステムとMaven/Gradleの関係

気になるテーマがあれば教えてください！

[module-info.java](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/module-info%20java%2023562cef735080bea671d6b0579891e4.md)

[依存関係, 公開範囲](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82,%20%E5%85%AC%E9%96%8B%E7%AF%84%E5%9B%B2%2023562cef735080f490f0fe0667ace10e.md)

[コマンド](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%2023562cef735080709a13f92f8234cfb4.md)

[—module-path -m](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/%E2%80%94module-path%20-m%2023562cef73508057bb5afc2100015237.md)

[java.Base など](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/java%20Base%20%E3%81%AA%E3%81%A9%2023562cef7350809fb232cfcd2aa63179.md)

[Unnamed → Named アクセス](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/Unnamed%20%E2%86%92%20Named%20%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%2023562cef73508038b2b3c4940130fe95.md)

[Named → Unnamed アクセス](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/Named%20%E2%86%92%20Unnamed%20%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%2023562cef7350800eacd9e8f087ce6159.md)

[API の互換性](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/API%20%E3%81%AE%E4%BA%92%E6%8F%9B%E6%80%A7%2023562cef735080b0a06ad777e2ef7b25.md)

[opens](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/opens%2024862cef735080eaad39cb19a35d29d7.md)

[jar配置図](%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%2023462cef7350801c9c64cd20d0d0e6b7/jar%E9%85%8D%E7%BD%AE%E5%9B%B3%2024b62cef735080e4841cf07c7e6ad460.md)