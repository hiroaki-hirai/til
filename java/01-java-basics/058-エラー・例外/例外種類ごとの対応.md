# 例外種類ごとの対応

# Q,

「例外種類ごとの対処法テンプレート集」をお願い致します。

承知しました、Hiroakiさん。

ここでは、**Javaでよく発生する例外種類ごとに、その対処法のテンプレートとポイント**をまとめた「例外種類ごとの対処法テンプレート集」をご紹介します。

---

# ✅ Java例外種類ごとの対処法テンプレート集

---

## 🧱 1. **構造・構文違反系**

### 例外例：

- `ArrayIndexOutOfBoundsException`
- `IllegalArgumentException`
- `ClassCastException`

### 🎯 主な原因：

- 想定外の引数やインデックス
- 型の不一致

### 🔧 対処テンプレート：

```java
public void process(String[] args) {
    if (args.length < 1) {
        throw new IllegalArgumentException("引数が不足しています");
    }

    try {
        int index = Integer.parseInt(args[0]);
        System.out.println("値: " + myArray[index]);
    } catch (ArrayIndexOutOfBoundsException e) {
        System.err.println("指定されたインデックスが範囲外です: " + e.getMessage());
    }
}
```

### 💡 ポイント：

- 事前に **バリデーション**（チェック）で防ぐのが最善
- `catch` はあくまで **二重保険**として

---

## 🚫 2. **null/存在しない参照系**

### 例外例：

- `NullPointerException`
- `NoSuchElementException`
- `FileNotFoundException`

### 🎯 主な原因：

- `null` にアクセス
- 存在しないファイル・値にアクセス

### 🔧 対処テンプレート：

```java
Optional<String> nameOpt = getName();
nameOpt.ifPresentOrElse(
    name -> System.out.println("Name: " + name),
    () -> System.out.println("Name is not available")
);

// ファイル読み込み
try (BufferedReader reader = new BufferedReader(new FileReader("file.txt"))) {
    String line = reader.readLine();
} catch (FileNotFoundException e) {
    System.err.println("ファイルが見つかりません: " + e.getMessage());
} catch (IOException e) {
    e.printStackTrace();
}
```

### 💡 ポイント：

- `Optional` を使って `null` 回避
- ファイル/DBなど外部リソースには `try-catch` が必須

---

## 🔄 3. **状態・ライフサイクル違反系**

### 例外例：

- `IllegalStateException`
- `ClosedChannelException`

### 🎯 主な原因：

- 初期化されていない or 閉じられたリソースの使用

### 🔧 対処テンプレート：

```java
if (socket == null || socket.isClosed()) {
    throw new IllegalStateException("ソケットが無効です");
}

try {
    socket.getOutputStream().write(data);
} catch (IOException e) {
    e.printStackTrace();
}
```

### 💡 ポイント：

- 状態確認メソッド（`isClosed()`など）で予防
- 使い回すリソースの状態チェックが重要

---

## 🌐 4. **外部依存エラー（IO/ネットワーク/DB）**

### 例外例：

- `IOException`
- `SocketException`
- `SQLException`

### 🎯 主な原因：

- 接続失敗、読み書き失敗など外部要因

### 🔧 対処テンプレート：

```java
try (Connection conn = DriverManager.getConnection(...)) {
    PreparedStatement stmt = conn.prepareStatement("SELECT * FROM users");
    ResultSet rs = stmt.executeQuery();
    // ...
} catch (SQLException e) {
    log.error("DBエラー: {}", e.getMessage());
    // リトライ処理や代替処理など
}
```

```java
int retries = 3;
while (retries-- > 0) {
    try {
        fetchFromServer();
        break;
    } catch (SocketException e) {
        System.err.println("再試行中... 残り: " + retries);
        Thread.sleep(1000);
    }
}
```

### 💡 ポイント：

- **ログ＋再試行**（リトライ）を組み合わせる
- DB接続や通信では、**障害復旧の方針**を設計段階で明示

---

## 🧮 5. **演算・変換エラー**

### 例外例：

- `ArithmeticException`
- `NumberFormatException`

### 🎯 主な原因：

- 0除算、文字列→数値変換の失敗

### 🔧 対処テンプレート：

```java
try {
    int x = Integer.parseInt(input);
    int result = 100 / x;
    System.out.println(result);
} catch (NumberFormatException e) {
    System.err.println("数値に変換できません: " + input);
} catch (ArithmeticException e) {
    System.err.println("無効な演算（0除算など）: " + e.getMessage());
}
```

### 💡 ポイント：

- 入力値のチェック＋`try-catch`で安全に制御
- UI・Web入力では特に注意

---

## 📦 6. **リフレクション/クラス動的処理系**

### 例外例：

- `ClassNotFoundException`
- `NoSuchMethodException`

### 🎯 主な原因：

- 実行時に指定したクラスやメソッドが存在しない

### 🔧 対処テンプレート：

```java
try {
    Class<?> clazz = Class.forName("com.example.MyClass");
    Method method = clazz.getDeclaredMethod("doSomething");
    method.invoke(clazz.getDeclaredConstructor().newInstance());
} catch (ClassNotFoundException | NoSuchMethodException |
         InstantiationException | IllegalAccessException |
         InvocationTargetException e) {
    e.printStackTrace();
}
```

### 💡 ポイント：

- 例外が多くなるため、**まとめてcatch**してログ管理
- フレームワーク内部でよく使われるが、開発者はエラーメッセージ確認が重要

---

# ✅ 最後に：例外処理設計のベストプラクティス

| 方針 | 説明 |
| --- | --- |
| ✔ バリデーションを優先 | チェックできるものは `try-catch` でなく事前条件チェックで防ぐ |
| ✔ 最小のスコープで try-catch | try の範囲を必要最小限にすると、例外原因を特定しやすい |
| ✔ catch では意味ある処理を | ログ出力・再スロー・フォールバック処理など、意図のある対処を |
| ✔ 独自例外の活用も視野に | ドメイン特有のエラーは `MyAppException` などで抽象化するのも有効 |

---

必要であれば、「独自例外クラスの設計テンプレート」や「例外処理のテスト方法」もご紹介できます。気になるテーマがあればお知らせください！