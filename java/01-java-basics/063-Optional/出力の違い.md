# 出力の違い

# Q,

値がある場合とない場合で出力の違いがどう出てくるか知りたいです。

```java
Map<String, User> db = new HashMap<>();

public Optional<User> findUser(String id) {
    if (db.containsKey(id)) {  // ← ここが正しい
        return Optional.of(db.get(id));
    } else {
        return Optional.empty();
    }
}
```

はい、Hiroakiさん。

`Optional<User> findUser(String id)` の戻り値が「**値あり**」と「**値なし（空）**」でどう違いが出るのか、具体的に見てみましょう。

---

## ✅ 前提コード

```java
Map<String, User> db = new HashMap<>();
db.put("001", new User("001", "Hiroaki"));

Optional<User> maybeUser = findUser("001");      // 存在するID
Optional<User> notFoundUser = findUser("999");   // 存在しないID
```

```java
public Optional<User> findUser(String id) {
    if (db.containsKey(id)) {
        return Optional.of(db.get(id));          // 値あり
    } else {
        return Optional.empty();                 // 値なし
    }
}
```

---

## 🎯 使用方法ごとの出力の違い

### ① `get()` を使った場合（※非推奨：空だと例外）

```java
System.out.println(maybeUser.get());       // → User@xxxx（UserのtoString結果）
System.out.println(notFoundUser.get());    // → NoSuchElementException（例外発生）
```

---

### ② `orElse(...)` を使った場合（安全）

```java
User user1 = maybeUser.orElse(new User("000", "Guest"));
User user2 = notFoundUser.orElse(new User("000", "Guest"));

System.out.println(user1.getName());  // → Hiroaki
System.out.println(user2.getName());  // → Guest
```

---

### ③ `ifPresent(...)` を使った場合（値があるときだけ実行）

```java
maybeUser.ifPresent(user -> System.out.println("Found: " + user.getName()));
notFoundUser.ifPresent(user -> System.out.println("Found: " + user.getName()));
```

出力結果：

```java
Found: Hiroaki
（notFoundUser は値がないので何も出力されない）
```

---

### ④ `isPresent()` で存在チェック

```java
if (maybeUser.isPresent()) {
    System.out.println("ユーザーが見つかりました。");
} else {
    System.out.println("ユーザーが見つかりません。");
}

if (notFoundUser.isPresent()) {
    System.out.println("ユーザーが見つかりました。");
} else {
    System.out.println("ユーザーが見つかりません。");
}
```

出力結果：

```java
ユーザーが見つかりました。
ユーザーが見つかりません。
```

---

## ✅ まとめ：Optionalの状態による出力比較

| 使用メソッド | 値あり (`Optional.of(...)`) | 値なし (`Optional.empty()`) |
| --- | --- | --- |
| `get()` | 値を返す | ❌ 例外（NoSuchElementException） |
| `orElse(...)` | 値を返す | 代替値を返す |
| `ifPresent(...)` | 処理が実行される | 何もしない |
| `isPresent()` | true | false |

---

## 💡 補足：User クラス例（for output）

```java
public class User {
    private String id;
    private String name;

    public User(String id, String name) {
        this.id = id;
        this.name = name;
    }

    public String getName() {
        return name;
    }

    @Override
    public String toString() {
        return "User{id='" + id + "', name='" + name + "'}";
    }
}
```

---

必要であれば `Optional.map()` や `Optional.flatMap()` でさらにスマートに処理する応用例もご紹介できます。お気軽にどうぞ！