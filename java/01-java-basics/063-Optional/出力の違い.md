# å‡ºåŠ›ã®é•ã„

# Q,

å€¤ãŒã‚ã‚‹å ´åˆã¨ãªã„å ´åˆã§å‡ºåŠ›ã®é•ã„ãŒã©ã†å‡ºã¦ãã‚‹ã‹çŸ¥ã‚ŠãŸã„ã§ã™ã€‚

```java
Map<String, User> db = new HashMap<>();

public Optional<User> findUser(String id) {
    if (db.containsKey(id)) {  // â† ã“ã“ãŒæ­£ã—ã„
        return Optional.of(db.get(id));
    } else {
        return Optional.empty();
    }
}
```

ã¯ã„ã€Hiroakiã•ã‚“ã€‚

`Optional<User> findUser(String id)` ã®æˆ»ã‚Šå€¤ãŒã€Œ**å€¤ã‚ã‚Š**ã€ã¨ã€Œ**å€¤ãªã—ï¼ˆç©ºï¼‰**ã€ã§ã©ã†é•ã„ãŒå‡ºã‚‹ã®ã‹ã€å…·ä½“çš„ã«è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

---

## âœ… å‰æã‚³ãƒ¼ãƒ‰

```java
Map<String, User> db = new HashMap<>();
db.put("001", new User("001", "Hiroaki"));

Optional<User> maybeUser = findUser("001");      // å­˜åœ¨ã™ã‚‹ID
Optional<User> notFoundUser = findUser("999");   // å­˜åœ¨ã—ãªã„ID
```

```java
public Optional<User> findUser(String id) {
    if (db.containsKey(id)) {
        return Optional.of(db.get(id));          // å€¤ã‚ã‚Š
    } else {
        return Optional.empty();                 // å€¤ãªã—
    }
}
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•ã”ã¨ã®å‡ºåŠ›ã®é•ã„

### â‘  `get()` ã‚’ä½¿ã£ãŸå ´åˆï¼ˆâ€»éæ¨å¥¨ï¼šç©ºã ã¨ä¾‹å¤–ï¼‰

```java
System.out.println(maybeUser.get());       // â†’ User@xxxxï¼ˆUserã®toStringçµæœï¼‰
System.out.println(notFoundUser.get());    // â†’ NoSuchElementExceptionï¼ˆä¾‹å¤–ç™ºç”Ÿï¼‰
```

---

### â‘¡ `orElse(...)` ã‚’ä½¿ã£ãŸå ´åˆï¼ˆå®‰å…¨ï¼‰

```java
User user1 = maybeUser.orElse(new User("000", "Guest"));
User user2 = notFoundUser.orElse(new User("000", "Guest"));

System.out.println(user1.getName());  // â†’ Hiroaki
System.out.println(user2.getName());  // â†’ Guest
```

---

### â‘¢ `ifPresent(...)` ã‚’ä½¿ã£ãŸå ´åˆï¼ˆå€¤ãŒã‚ã‚‹ã¨ãã ã‘å®Ÿè¡Œï¼‰

```java
maybeUser.ifPresent(user -> System.out.println("Found: " + user.getName()));
notFoundUser.ifPresent(user -> System.out.println("Found: " + user.getName()));
```

å‡ºåŠ›çµæœï¼š

```java
Found: Hiroaki
ï¼ˆnotFoundUser ã¯å€¤ãŒãªã„ã®ã§ä½•ã‚‚å‡ºåŠ›ã•ã‚Œãªã„ï¼‰
```

---

### â‘£ `isPresent()` ã§å­˜åœ¨ãƒã‚§ãƒƒã‚¯

```java
if (maybeUser.isPresent()) {
    System.out.println("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚");
} else {
    System.out.println("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
}

if (notFoundUser.isPresent()) {
    System.out.println("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚");
} else {
    System.out.println("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
}
```

å‡ºåŠ›çµæœï¼š

```java
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
```

---

## âœ… ã¾ã¨ã‚ï¼šOptionalã®çŠ¶æ…‹ã«ã‚ˆã‚‹å‡ºåŠ›æ¯”è¼ƒ

| ä½¿ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ | å€¤ã‚ã‚Š (`Optional.of(...)`) | å€¤ãªã— (`Optional.empty()`) |
| --- | --- | --- |
| `get()` | å€¤ã‚’è¿”ã™ | âŒ ä¾‹å¤–ï¼ˆNoSuchElementExceptionï¼‰ |
| `orElse(...)` | å€¤ã‚’è¿”ã™ | ä»£æ›¿å€¤ã‚’è¿”ã™ |
| `ifPresent(...)` | å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ | ä½•ã‚‚ã—ãªã„ |
| `isPresent()` | true | false |

---

## ğŸ’¡ è£œè¶³ï¼šUser ã‚¯ãƒ©ã‚¹ä¾‹ï¼ˆfor outputï¼‰

```java
public class User {
    private String id;
    private String name;

    public User(String id, String name) {
        this.id = id;
        this.name = name;
    }

    public String getName() {
        return name;
    }

    @Override
    public String toString() {
        return "User{id='" + id + "', name='" + name + "'}";
    }
}
```

---

å¿…è¦ã§ã‚ã‚Œã° `Optional.map()` ã‚„ `Optional.flatMap()` ã§ã•ã‚‰ã«ã‚¹ãƒãƒ¼ãƒˆã«å‡¦ç†ã™ã‚‹å¿œç”¨ä¾‹ã‚‚ã”ç´¹ä»‹ã§ãã¾ã™ã€‚ãŠæ°—è»½ã«ã©ã†ãï¼